(function(a,b){dshop.add("template",function(){var c=function(){var d={};var e=function(){};e.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(i,h,g,j){if(!j){this.context=h;this.buffer=[]}if(!this.includes("",i)){if(j){return i}else{this.send(i);return}}i=this.render_pragmas(i);var f=this.render_section(i,h,g);if(f===false){f=this.render_tags(i,h,g,j)}if(j){return f}else{this.sendLines(f)}},send:function(f){if(f!==""){this.buffer.push(f)}},sendLines:function(h){if(h){var f=h.split("\n");for(var g=0;g<f.length;g++){this.send(f[g])}}},render_pragmas:function(f){if(!this.includes("%",f)){return f}var h=this;var g=this.getCachedRegex("render_pragmas",function(j,i){return new RegExp(j+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+i,"g")});return f.replace(g,function(k,i,j){if(!h.pragmas_implemented[i]){throw ({message:"This implementation of mustache doesn't understand the '"+i+"' pragma"})}h.pragmas[i]={};if(j){var l=j.split("=");h.pragmas[i][l[0]]=l[1]}return""})},render_partial:function(f,h,g){f=this.trim(f);if(!g||g[f]===undefined){throw ({message:"unknown_partial '"+f+"'"})}if(typeof(h[f])!="object"){return this.render(g[f],h,g,true)}return this.render(g[f],h[f],g,true)},render_section:function(h,g,f){if(!this.includes("#",h)&&!this.includes("^",h)){return false}var j=this;var i=this.getCachedRegex("render_section",function(l,k){return new RegExp("^([\\s\\S]*?)"+l+"(\\^|\\#)\\s*(.+)\\s*"+k+"\n*([\\s\\S]*?)"+l+"\\/\\s*\\3\\s*"+k+"\\s*([\\s\\S]*)$","g")});return h.replace(i,function(n,r,q,m,o,l){var t=r?j.render_tags(r,g,f,true):"",p=l?j.render(l,g,f,true):"",k,s=j.find(m,g);if(q==="^"){if(!s||j.is_array(s)&&s.length===0){k=j.render(o,g,f,true)}else{k=""}}else{if(q==="#"){if(j.is_array(s)){k=j.map(s,function(u){return j.render(o,j.create_context(u),f,true)}).join("")}else{if(j.is_object(s)){k=j.render(o,j.create_context(s),f,true)}else{if(typeof s==="function"){k=s.call(g,o,function(u){return j.render(u,g,f,true)})}else{if(s){k=j.render(o,g,f,true)}else{k=""}}}}}}return t+k+p})},render_tags:function(o,f,h,k){var j=this;var n=function(){return j.getCachedRegex("render_tags",function(q,i){return new RegExp(q+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+i+"+","g")})};var l=n();var m=function(r,i,q){switch(i){case"!":return"";case"=":j.set_delimiters(q);l=n();return"";case">":return j.render_partial(q,f,h);case"{":return j.find(q,f);default:return j.escape(j.find(q,f))}};var p=o.split("\n");for(var g=0;g<p.length;g++){p[g]=p[g].replace(l,m,this);if(!k){this.send(p[g])}}if(k){return p.join("\n")}},set_delimiters:function(g){var f=g.split(" ");this.otag=this.escape_regex(f[0]);this.ctag=this.escape_regex(f[1])},escape_regex:function(g){if(!arguments.callee.sRE){var f=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+f.join("|\\")+")","g")}return g.replace(arguments.callee.sRE,"\\$1")},find:function(g,h){g=this.trim(g);function f(j){return j===false||j===0||j}var i;if(f(h[g])){i=h[g]}else{if(f(this.context[g])){i=this.context[g]}}if(typeof i==="function"){return i.apply(h)}if(i!==undefined){return i}return""},includes:function(g,f){return f.indexOf(this.otag+g)!=-1},escape:function(f){f=String(f===null?"":f);return f.replace(/&(?!\w+;)|["'<>\\]/g,function(g){switch(g){case"&":return"&amp;";case'"':return"&quot;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;";default:return g}})},create_context:function(g){if(this.is_object(g)){return g}else{var h=".";if(this.pragmas["IMPLICIT-ITERATOR"]){h=this.pragmas["IMPLICIT-ITERATOR"].iterator}var f={};f[h]=g;return f}},is_object:function(f){return f&&typeof f=="object"},is_array:function(f){return Object.prototype.toString.call(f)==="[object Array]"},trim:function(f){return f.replace(/^\s*|\s*$/g,"")},map:function(k,h){if(typeof k.map=="function"){return k.map(h)}else{var j=[];var f=k.length;for(var g=0;g<f;g++){j.push(h(k[g]))}return j}},getCachedRegex:function(g,j){var i=d[this.otag];if(!i){i=d[this.otag]={}}var f=i[this.ctag];if(!f){f=i[this.ctag]={}}var h=f[g];if(!h){h=f[g]=j(this.otag,this.ctag)}return h}};return({name:"mustache.js",version:"0.4.0-dev",to_html:function(h,f,g,j){var i=new e();if(j){i.send=j}i.render(h,f||{},g);if(!j){return i.buffer.join("\n")}}})}();dshop.mods.template=c})})(window,jQuery);